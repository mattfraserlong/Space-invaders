<html>

<head>
    <style>
        #hero {
            background: #ff0000;
            width: 20px;
            height: 20px;
            position: absolute;
        }

        #background {
            background: #000000;
            width: 500px;
            height: 500px;
            position: absolute;
            left: 20px;
            top: 20px;
        }

        #laser {
            background: #00ff00;
            width: 4px;
            height: 50px;
            position: absolute;
        }

        #enemy {
            background: #0000ff;
            width: 30px;
            height: 30px;
            position: absolute;
        }

    </style>
</head>

<body>
    <div id="background"></div>
    <div id="hero"></div>
    <div id="laser"></div>
    <div id="enemy"></div>
    <script>
        let LEFT_KEY = 37;
        let UP_KEY = 38;
        let RIGHT_KEY = 39;
        let DOWN_KEY = 40;
        let SPACE_KEY = 32;
        let HERO_MOVEMENT = 20;
        let LASER_SPEED = 10;
        let ENEMY_SPEED = 10;

        let lastLoopRun = 0;

        let controller = new Object();

        function ensureBounds() {
            if (hero.x >= 480) {
                hero.x = 480;
            }
            if (hero.x <= 40) {
                hero.x = 40;
            }
            if (hero.y >= 480) {
                hero.y = 480;
            }
            if (hero.y <= 40) {
                hero.y = 40;
            }
            if (laser.y <= 20) {
                laser.y = -120;
            }
            if (enemy.y >= 480) {
                enemy.y = 30;
                enemy.x = (RandomNumber(440) + 40)
            }
        }

        function createSprite(element, x, y, w, h) {
            spriteObj = new Object();
            spriteObj.element = element;
            spriteObj.x = x;
            spriteObj.y = y;
            spriteObj.w = w;
            spriteObj.h = h;
            return spriteObj;
        }

        function toggleKey(keyCode, isPressed) {
            if (keyCode == LEFT_KEY) {
                controller.left = isPressed;
            }
            if (keyCode == RIGHT_KEY) {
                controller.right = isPressed;
            }
            if (keyCode == UP_KEY) {
                controller.up = isPressed;
            }
            if (keyCode == DOWN_KEY) {
                controller.down = isPressed;
            }
            if (keyCode == SPACE_KEY) {
                controller.space = isPressed;
            }
        }

        function updatePositions() {
            laser.y -= LASER_SPEED;
            enemy.y += ENEMY_SPEED;
        }

        function intersects(a, b) {
            return a.x < b.x + b.w && a.x + a.w > b.x && a.y < b.y + b.h && a.y + a.h > b.y;
        }

        function RandomNumber(maxSize) {
            return parseInt(Math.random() * maxSize);
        }


        function setPosition(sprite) {
            var e = document.getElementById(sprite.element);
            e.style.left = sprite.x + 'px';
            e.style.top = sprite.y + 'px';
        }

        function handleControls() {
            if (controller.up) {
                hero.y -= HERO_MOVEMENT;
            }
            if (controller.down) {
                hero.y += HERO_MOVEMENT;
            }
            if (controller.left) {
                hero.x -= HERO_MOVEMENT;
            }
            if (controller.right) {
                hero.x += HERO_MOVEMENT;
            }
            if (controller.space & laser.y <= -120) {
                laser.x = hero.x + 8;
                laser.y = hero.y - 50;
            }
            ensureBounds();
        }

        function showSprites() {
            setPosition(hero);
            setPosition(laser);
            setPosition(enemy);
        }

        function checkCollisions() {
            if (intersects(laser, enemy)) {
                var element = document.getElementById(enemy.element);
                enemy.y = 40;
                enemy.x = (RandomNumber(460) + 40)
                console.log('hit');
                //element.parentNode.removeChild(element);
            } else if (intersects(hero, enemy)) {
                var element = document.getElementById(hero.element);
                enemy.y = 40;
                enemy.x = (RandomNumber(460) + 40)
                //element.style.visibility = 'hidden';
                console.log('hit');
            } else if (enemy.y >= 480) {
                var element = document.getElementById(enemy.element);
                element.style.visibility = 'hidden';
                //element.parentNode.removeChild(element);
                console.log('hit');
            }
        }


        function loop() {
            if (new Date().getTime() - lastLoopRun > 40) {
                updatePositions();
                handleControls();
                checkCollisions();

                showSprites();
                

                lastLoopRun = new Date().getTime();
            }
            setTimeout('loop();', 2);
        }

        document.onkeydown = function(evt) {
            toggleKey(evt.keyCode, true);
        };

        document.onkeyup = function(evt) {
            toggleKey(evt.keyCode, false);
        };

        var hero = createSprite('hero', 250, 460, 20, 20);
        var laser = createSprite('laser', 5, -120, 10, 10);
        var enemy = createSprite('enemy', (RandomNumber(440) + 40), 30, 30, 30)

        loop();

    </script>
</body>

</html>
